(()=>{"use strict";const t=document.getElementById("main"),e=Array.from({length:4},((t,e)=>e+1));class n{constructor(t,n,i){this._title=t,this._description=n,this._priorities=e,this._priorityIndex=i,(i<0||i>3)&&(this._priorityIndex=3)}set title(t){this._title=t}get title(){return this._title}set description(t){this._description=t}get description(){return this._description}set priorityIndex(t){t>=0&&t<=3&&(this._priorityIndex=t)}get priorityIndex(){return this._priorityIndex}get priorities(){return this._priorities}get priority(){return this._priorities[this._priorityIndex]}}class i{constructor(t){this._title=t,this._tasks=[]}set title(t){this._title=t}get title(){return this._title}createTask(t,e,i){const s=new n(t,e,i);this._tasks.push(s)}getTasks(){return this._tasks}getTask(t){return this._tasks[t]}_setTaskProperty(t,e,n){const i=this.getTask(n);i&&(i[t]=e)}setTaskTitle(t,e){this._setTaskProperty("title",t,e)}setTaskDescription(t,e){this._setTaskProperty("description",t,e)}setTaskPriorityIndex(t,e){this._setTaskProperty("priorityIndex",t,e)}deleteTask(t){t&&this._tasks.splice(t,1)}}const s=new class{_projects=[];_currentProjectIndex=null;_setCurrentProjectIndex(t){t>=0&&t<this._projects.length&&(this._currentProjectIndex=t)}createProject(t){const e=new i(t);this._projects.push(e),this._setCurrentProjectIndex(this._projects.length-1)}getProjects(){return this._projects}getProject(t){return this._setCurrentProjectIndex(t),this._projects[t]}getCurrentProject(){return this._projects[this._currentProjectIndex]}setProjectTitle(t,e){const n=this.getProject(e);n&&(n.title=t)}deleteProject(t){t&&this._projects.splice(t,1)}deleteProjects(){this._projects.length=0}};class r{static getItem(t){return localStorage.getItem(t)}static setItem(t,e){localStorage.setItem(t,e)}}function c(t){r.setItem("Projects",JSON.stringify(t))}class o{static fetchProjects(){!function(t){const e=JSON.parse(r.getItem("Projects"));e&&(t.deleteProjects(),e._projects.forEach((e=>{t.createProject(e._title),e._tasks.forEach((e=>{t.getCurrentProject().createTask(e._title,e._description,e._priorityIndex)}))})),t._currentProjectIndex=e._currentProjectIndex)}(s)}static createProject(t){s.createProject(t),c(s)}static getProjects(){return s.getProjects()}static getProject(t){const e=s.getProject(t);return c(s),e}static getProjectTitles(){return this.fetchProjects(),this.getProjects().map((t=>t.title))}static setProjectTitle(t,e){s.setProjectTitle(t,e),c(s)}static deleteProject(t){s.deleteProject(t),c(s)}static createCurrentProjectTask(t,e="",n=3){s.getCurrentProject().createTask(t,e,n),c(s)}static getCurrentProjectTasks(){return s.getCurrentProject().getTasks()}static getCurrentProjectTask(t){return s.getCurrentProject().getTask(t)}static setCurrentProjectTaskTitle(t,e){s.getCurrentProject().setTaskTitle(t,e),c(s)}static setCurrentProjectTaskDescription(t,e){s.getCurrentProject().setTaskDescription(t,e),c(s)}static setCurrentProjectTaskPriorityIndex(t,e){s.getCurrentProject().setTaskPriorityIndex(t,e),c(s)}static deleteCurrentProjectTask(t){s.getCurrentProject().deleteTask(t),c(s)}}const l=["red","yellow","deepskyblue","currentColor"];function a(){const t=document.getElementById("projects");t.innerHTML="",o.getProjectTitles().map(((t,e)=>function(t,e){return`<div id='${e}' class='row my-3'>\n      <div class="col project-title">${t}</div>\n      <div class="col-auto read">\n        <i class="bi bi-box-arrow-in-right"></i>\n      </div>\n\n      <div class="col-auto delete">\n        <i class="bi bi-trash3"></i>\n      </div>\n    </div>`}(t,e))).forEach((e=>t.insertAdjacentHTML("beforeend",e)))}function d(){const t=document.getElementById("tasks");t.innerHTML="",o.getCurrentProjectTasks().map(((t,e)=>{return`<div id='${e}' class='task row my-3 align-items-center'>\n      <div class="row col">\n        <div class="col task-title">${t.title}</div>\n        <div class="col-12 task-description" style="font-size: 0.75rem;">\n          ${t.description}\n        </div>\n      </div>\n\n      <div class="col-auto task-priority">\n        <button id="${n=t.priorityIndex}" class="btn" data-bs-toggle="dropdown">\n          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="${l[n]}" class="bi bi-flag-fill" viewBox="0 0 16 16">\n          <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/></svg>\n        </button>\n        <ul class="dropdown-menu task-priorities">\n          <li id="0" class="dropdown-item">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="${l[0]}" class="bi bi-flag-fill" viewBox="0 0 16 16">\n            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/></svg> High\n          </li>\n          <li id="1" class="dropdown-item">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="${l[1]}" class="bi bi-flag-fill" viewBox="0 0 16 16">\n            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/></svg> Middle\n          </li>\n          <li id="2" class="dropdown-item">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="${l[2]}" class="bi bi-flag-fill" viewBox="0 0 16 16">\n            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/></svg> Low\n          </li>\n          <li id="3" class="dropdown-item">\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="${l[3]}" class="bi bi-flag-fill" viewBox="0 0 16 16">\n            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/></svg> Common\n          </li>\n        </ul>\n      </div>\n      <div class="col-auto delete">\n        <i class="bi bi-trash3"></i>\n      </div>\n    </div>`;var n})).forEach((e=>{t.insertAdjacentHTML("beforeend",e),function(){const t=document.querySelectorAll(".task-priority");Array.from(t).forEach((t=>{const e=t.firstElementChild.id,n=t.querySelector(".task-priorities");Array.from(n.children).forEach((t=>{t.id===e&&t.classList.add("active")}))}))}()}))}function u(t){t.classList.add("is-invalid"),t.classList.remove("is-valid")}function v(t){t.classList.add("is-valid"),t.classList.remove("is-invalid")}function p(t){t.classList.remove("is-invalid"),t.classList.remove("is-valid")}let g,h,m,f,k,j,w,y,P,b,T;function C(){h.toggleAttribute("hidden"),m.focus()}function x(){v(m),m.value.length<3&&(u(m),f.innerHTML="Should be at least 3 characters in length")}function E(){p(m)}function _(){C(),m.value="",E()}function I(t){return t.closest(".row").id}function L(t,e){return t.toLowerCase().includes(e.toLowerCase().trim())}function B(){P.toggleAttribute("hidden")}function A(){v(P.title),P.title.value.length<3&&(u(P.title),b.innerHTML="Should be at least 3 characters in length")}function V(){p(P.title)}function M(){B(),P.title.value="",P.description.value="",P.priority.value="3",V()}function $(t){return t.closest(".task").id}function H(t,e){o.setCurrentProjectTaskTitle(t,e),d()}function S(t,e){o.setCurrentProjectTaskDescription(t,e),d()}function D(t,e,n,i){const s=document.createElement("input");return s.classList.add(e),s.style.backgroundColor="#212529",s.style.border="none",s.value=t,s.addEventListener("change",(()=>{n(s.value,i)})),s}function q(t){T.addEventListener("click",(e=>{const n=e.target.closest(t);if(!n)return;let i;switch(t){case".task-title":i=D(n.innerText,"col",H,$(e.target));break;case".task-description":i=D(n.innerText,"col-12",S,$(e.target))}n.replaceWith(i),i.focus()}))}t.innerHTML='\n  <div class="text-center my-3">\n\n    <h1 class="my-5">\n      Projects\n    </h1>\n\n    <div class="row m-3">\n      <input id=\'search-project\' type="text" placeholder="Search project">\n    </div>\n\n    <div id="new-project" class="text-secondary border rounded m-3 p-1">\n      New project\n    </div>\n\n    <form id="new-project-form" class="row justify-content-center align-items-center my-5 p-1" hidden>\n      <div class="row align-items-center my-3">\n\n        <div class="col-auto">\n          <label for="new-project-title" class="form-label">Title</label>\n        </div>\n\n        <div class="col">\n          <input type="text" class="form-control" id="new-project-title" minlength="3" required>\n          <div id="new-project-title-feedback" class="invalid-feedback"></div>\n        </div>\n\n      </div>\n\n      <button id="new-project-add" class="col-2 btn btn-light">Add</button>\n      <button type="reset" id="new-project-close" class="col-2 btn btn-dark">Close</button>\n\n    </form>\n\n    <div id="projects" class=\'text-start mx-3\'></div>\n\n  </div>',a(),function(){const t=document.getElementById("search-project"),e=o.getProjectTitles();t.addEventListener("input",(()=>{!function(t,e){t.forEach(((t,n)=>{t.toLowerCase().includes(e.toLowerCase().trim())?document.getElementById(n).hidden=!1:document.getElementById(n).hidden=!0}))}(e,t.value)}))}(),g=document.getElementById("new-project"),h=document.getElementById("new-project-form"),m=document.getElementById("new-project-title"),f=document.getElementById("new-project-title-feedback"),k=document.getElementById("new-project-close"),j=document.getElementById("new-project-add"),g.addEventListener("click",(()=>{E(),C()})),k.addEventListener("click",(()=>{_()})),j.addEventListener("click",(t=>{if(t.preventDefault(),!h.checkValidity())return void x();const e=m.value;o.createProject(e),_(),a()})),m.addEventListener("focusout",(()=>{x()})),w=document.getElementById("projects"),w.addEventListener("click",(e=>{if(!e.target.closest(".read"))return;const n=I(e.target);o.getProject(n),t.innerHTML='\n  <div class="text-center my-3">\n\n    <h1 class="my-5">\n      Tasks\n    </h1>\n\n    <div class="row m-3">\n      <input id=\'search-task\' type="text" placeholder="Search task">\n    </div>\n\n    <div id="new-task" class="text-secondary border rounded m-3 p-1">\n      New task\n    </div>\n\n    <form id="new-task-form" class="row justify-content-center align-items-center my-5 p-1" hidden>\n      <div class="row align-items-center my-3">\n\n        <div class="row align-items-center my-3">\n          <div class="col-4">\n            <label for="new-task-title" class="form-label">Title*</label>\n          </div>\n          \n          <div class="col">\n            <input type="text" class="form-control" id="new-task-title" name="title" minlength="3" required>\n            <div id="new-task-title-feedback" class="invalid-feedback"></div>\n          </div>\n        </div>\n\n        <div class="row align-items-center my-3">\n          <div class="col-4">\n            <label for="new-task-description" class="form-label">Description</label>\n          </div>\n          \n          <div class="col">\n            <textarea class="form-control" id="new-task-description" name="description"></textarea>\n          </div>\n        </div>\n\n        <div class="row align-items-center my-3">\n          <div class="col-4">\n            <label for="new-task-priority" class="form-label">Priority</label>\n          </div>\n          \n          <select class="col form-select mx-2" id="new-task-priority" name="priority">\n            <option value="0">High</option>\n            <option value="1">Middle</option>\n            <option value="2">Low</option>\n            <option value="3" selected>Common</option>\n          </select>\n        </div>\n\n      </div>\n\n      <button id="new-task-add" class="col-2 btn btn-light" name="add">Add</button>\n      <button type="reset" id="new-task-close" class="col-2 btn btn-dark" name="close">Close</button>\n\n    </form>\n\n    <div id="tasks" class=\'text-start mx-3\'></div>\n\n  </div>',d(),function(){const t=document.getElementById("search-task"),e=o.getCurrentProjectTasks();t.addEventListener("input",(()=>{!function(t,e){t.forEach(((t,n)=>{L(t.title,e)||L(t.description,e)?document.getElementById(n).hidden=!1:document.getElementById(n).hidden=!0}))}(e,t.value)}))}(),y=document.getElementById("new-task"),P=document.getElementById("new-task-form"),b=document.getElementById("new-task-title-feedback"),y.addEventListener("click",(()=>{V(),B()})),P.close.addEventListener("click",(()=>{M()})),P.add.addEventListener("click",(t=>{var e,n,i;t.preventDefault(),P.checkValidity()?(e=P.title.value,n=P.description.value,i=P.priority.value,o.createCurrentProjectTask(e,n,i),M(),d()):A()})),P.title.addEventListener("focusout",(()=>{A()})),T=document.getElementById("tasks"),q(".task-title"),q(".task-description"),T.addEventListener("click",(t=>{var e,n;t.target.closest(".task-priorities")&&(e=t.target.closest("li").id,n=$(t.target),o.setCurrentProjectTaskPriorityIndex(e,n),d())})),T.addEventListener("click",(t=>{if(!t.target.closest(".delete"))return;const e=$(t.target);o.deleteCurrentProjectTask(e),d()}))})),w.addEventListener("click",(t=>{const e=t.target.closest(".project-title");if(!e)return;const n=function(t,e){const n=document.createElement("input");return n.classList.add("col"),n.style.backgroundColor="#212529",n.style.border="none",n.value=t,n.addEventListener("change",(()=>{var t,i;t=n.value,i=e,o.setProjectTitle(t,i),a()})),n}(e.innerText,I(t.target));e.replaceWith(n),n.focus()})),w.addEventListener("click",(t=>{if(!t.target.closest(".delete"))return;const e=I(t.target);o.deleteProject(e),a()}))})();